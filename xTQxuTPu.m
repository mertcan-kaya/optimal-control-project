function y = xTQxuTPu(G)

A = [0,1;-1,0];
B = [0;1];

Q = [G(1),0;0,G(2)];
P = G(3);

G
R = icare(A,B,Q,P,[],[],[])

K = R*B/P;

k1 = K(1);
k2 = K(2);

% a) integrate from 0 to T
% T = 10;

% x(t) = (exp(-t*(k2/2 + (k2^2 - 4*k1 - 4)^(1/2)/2))*((k2^2 - 4*k1 - 4)^(1/2) - k2 + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)) + (exp(-t*(k2/2 - (k2^2 - 4*k1 - 4)^(1/2)/2))*(k2 + (k2^2 - 4*k1 - 4)^(1/2) - 2))/(2*(k2^2 - 4*k1 - 4)^(1/2));
% 
% Dx(t) = (exp(-t*(k2/2 + (k2^2 - 4*k1 - 4)^(1/2)/2))*(2*k1 - k2 - (k2^2 - 4*k1 - 4)^(1/2) + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)) - (exp(-(t*(k2 - (k2^2 - 4*k1 - 4)^(1/2)))/2)*(2*k1 - k2 + (k2^2 - 4*k1 - 4)^(1/2) + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2));
% 
% u(t) = - k2*((exp(-t*(k2/2 + (k2^2 - 4*k1 - 4)^(1/2)/2))*(2*k1 - k2 - (k2^2 - 4*k1 - 4)^(1/2) + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)) - (exp(-(t*(k2 - (k2^2 - 4*k1 - 4)^(1/2)))/2)*(2*k1 - k2 + (k2^2 - 4*k1 - 4)^(1/2) + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2))) - k1*((exp(-t*(k2/2 + (k2^2 - 4*k1 - 4)^(1/2)/2))*((k2^2 - 4*k1 - 4)^(1/2) - k2 + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)) + (exp(-(t*(k2 - (k2^2 - 4*k1 - 4)^(1/2)))/2)*(k2 + (k2^2 - 4*k1 - 4)^(1/2) - 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)));

% X = [x;Dx];

% y = int(1*x*x+1*Dx*Dx+1*u*u,t,[0 T])

q1 = G(1);
q2 = G(2);
p = G(3);

% y = p*(((exp(-T*(k2 + (k2^2 - 4*k1 - 4)^(1/2)))/2 - 1/2)*(k1^3*(k2^2 - 4*k1 - 4)^(1/2) - 4*k1*k2^2 + 2*k1^2*k2 + k1*k2^3 + k1^3*k2 + 4*k1^2 + 4*k1^3 - 4*k2^2 + 2*k2^3 - 2*k1^2*k2^2 - 4*k1*k2*(k2^2 - 4*k1 - 4)^(1/2) + k1*k2^2*(k2^2 - 4*k1 - 4)^(1/2) - 2*k1^2*k2*(k2^2 - 4*k1 - 4)^(1/2)))/((k1 + 1)*(- 2*k2^2 + 8*k1 + 8)) + ((exp(-T*(k2 - (k2^2 - 4*k1 - 4)^(1/2)))/2 - 1/2)*(2*k1^2*k2 - 4*k1*k2^2 - k1^3*(k2^2 - 4*k1 - 4)^(1/2) + k1*k2^3 + k1^3*k2 + 4*k1^2 + 4*k1^3 - 4*k2^2 + 2*k2^3 - 2*k1^2*k2^2 + 4*k1*k2*(k2^2 - 4*k1 - 4)^(1/2) - k1*k2^2*(k2^2 - 4*k1 - 4)^(1/2) + 2*k1^2*k2*(k2^2 - 4*k1 - 4)^(1/2)))/((k1 + 1)*(- 2*k2^2 + 8*k1 + 8)) - (8*(exp(-T*k2)/2 - 1/2)*(k1^3 - k1^2*k2 + 2*k1^2 + k1*k2^2 - k2^3 + 2*k2^2))/(k2*(- 2*k2^2 + 8*k1 + 8))) - q1*((2*(exp(-T*(k2 - (k2^2 - 4*k1 - 4)^(1/2)))/2 - 1/2)*(k2 + (- 2*k2^2 + 4*k2 + 2*k1)/(k2 - (k2^2 - 4*k1 - 4)^(1/2)) - 2))/(- 2*k2^2 + 8*k1 + 8) + (2*(exp(-T*(k2 + (k2^2 - 4*k1 - 4)^(1/2)))/2 - 1/2)*(k2 + (- 2*k2^2 + 4*k2 + 2*k1)/(k2 + (k2^2 - 4*k1 - 4)^(1/2)) - 2))/(- 2*k2^2 + 8*k1 + 8) + (8*(exp(-T*k2)/2 - 1/2)*(k1 - k2 + 2))/(k2*(- 2*k2^2 + 8*k1 + 8))) - q2*((exp(-T*(k2 + (k2^2 - 4*k1 - 4)^(1/2)))*(2*k1 - k2 + (k1*(k2^2 - 4*k1 - 4)^(1/2))/2 - (k1*k2)/2 + 2) - exp(-T*(k2 - (k2^2 - 4*k1 - 4)^(1/2)))*(k2 - 2*k1 + (k1*(k2^2 - 4*k1 - 4)^(1/2))/2 + (k1*k2)/2 - 2) + (4*exp(-T*k2)*(k1 + 1)*(k1 - k2 + 2))/k2)/(- 2*k2^2 + 8*k1 + 8) - (k1 + 2)/(2*k2))

% b) integrate from 0 to infinite
syms t

x(t) = (exp(-t*(k2/2 + (k2^2 - 4*k1 - 4)^(1/2)/2))*((k2^2 - 4*k1 - 4)^(1/2) - k2 + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)) + (exp(-t*(k2/2 - (k2^2 - 4*k1 - 4)^(1/2)/2))*(k2 + (k2^2 - 4*k1 - 4)^(1/2) - 2))/(2*(k2^2 - 4*k1 - 4)^(1/2));
Dx(t) = (exp(-t*(k2/2 + (k2^2 - 4*k1 - 4)^(1/2)/2))*(2*k1 - k2 - (k2^2 - 4*k1 - 4)^(1/2) + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)) - (exp(-(t*(k2 - (k2^2 - 4*k1 - 4)^(1/2)))/2)*(2*k1 - k2 + (k2^2 - 4*k1 - 4)^(1/2) + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2));
u(t) = - k2*((exp(-t*(k2/2 + (k2^2 - 4*k1 - 4)^(1/2)/2))*(2*k1 - k2 - (k2^2 - 4*k1 - 4)^(1/2) + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)) - (exp(-(t*(k2 - (k2^2 - 4*k1 - 4)^(1/2)))/2)*(2*k1 - k2 + (k2^2 - 4*k1 - 4)^(1/2) + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2))) - k1*((exp(-t*(k2/2 + (k2^2 - 4*k1 - 4)^(1/2)/2))*((k2^2 - 4*k1 - 4)^(1/2) - k2 + 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)) + (exp(-(t*(k2 - (k2^2 - 4*k1 - 4)^(1/2)))/2)*(k2 + (k2^2 - 4*k1 - 4)^(1/2) - 2))/(2*(k2^2 - 4*k1 - 4)^(1/2)));

y = double(int(q1*x*x+q2*Dx*Dx+p*u*u,t,0,inf))
